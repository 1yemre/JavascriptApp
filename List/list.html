<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <style>
          .dropdown-toggle::after
          {
             display: none;
          }
          .task{
             display: flex;
             align-items: center;
             justify-content: space-between;
          }

          .task label.checked
          {
             text-decoration: line-through;
          }
          .controls
          {
             display: flex;
             align-items: center;
             justify-content: space-between;
          }
          .filters span.active{
              color:#3c87ff;
          }
          .filters span{
             margin-right: 5px;
             font-size: 15px;
             column-rule-color: #444;
             cursor: pointer;
           }
    </style>


    <title>Document</title>
</head>
<body>
    

  <div class="container">
        <div class="row">
               <div class="col-12">
                     <div class="card">
                            <div class="card-header">
                                    Todo App
                            </div>
                            <div class="card-body">
                                   <form>
                                       <div class="input-group">
                                             <input type="text" id="txtTaskName" class="form-control">
                                             <button class="btn btn-primary" id="btnAddNewTask" type="submit">Ekle</button>
                                       </div>
                                   </form>
                            </div>
                            
                     </div>
                     <div class="card mt-3">

                        <div class="card-header  controls">

                                   <div class="filters">
                                         <span class="active" id="all">Hepsi</span>
                                         <span  id="pending">Yapılacaklar</span>
                                         <span  id="completed">Tamamlananlar</span>
                                   </div>



                                <button class="btn btn-danger float-end btn-sm" id="btnCLEAR" >Sil</button>
                        </div>
                        <ul id="task-list" class="list-group list-group-flush">
                            <!-- <li class="task list-group-item">
                                         <div class="form-check">
                                                     <input type="checkbox" id="1" class="form-check-input">    
                                                     <label for="1" class="form-check-label">Görev1</label>         
                                         </div>
                            </li> -->

                         </ul>
                     </div>
               </div>
        </div>
  </div>


  <!-- <div class="card-header">
      <div class="card-title h1" id="title">todo app2</div>
  </div>


  <ul id="task-list">
       <li class="task">Gorev1</li>
       <li class="task">Gorev2</li>
       <li class="task">Gorev3</li>
       <li class="task">Gorev4</li>
       <li class="task">Gorev5</li>
  </ul> -->

  <!-- <ul id="task-list2">
    <li class="task">Gorev1</li>
    <li class="task">Gorev2</li>
    <li class="task">Gorev3</li>
    <li class="task">Gorev4</li>
    <li class="task">Gorev5</li>
</ul> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
//document.getElementById("title");


//single elements
/*
let sonuc;
sonuc=document.getElementById("title");
sonuc=document.getElementById("title").id;
sonuc=document.getElementById("title").className;
sonuc=document.getElementById("title").classList;

document.getElementById("title").style.fontSize="30px";
document.getElementById("title").style.color="blue";
//document.getElementById("title").style.display="none";
document.getElementById("title").innerText="Todo App";
document.getElementById("title").innerHTML="<p>Todo App</p>";

sonuc=document.querySelector("#title");
sonuc=document.querySelector(".card-header");//sayfada bulduğu ilk .card-header classını bulur.
sonuc=document.querySelector(".div");//sayfada bulduğu ilk div'i bulur.

//sonuc=document.querySelector("li");
//sonuc=document.querySelector("li");
//sonuc=document.querySelector("li:first-child");
//sonuc=document.querySelector("li:last-child");
//sonuc=document.querySelector("li:nth-child(2)");

*/

//multiplay elements
/*
let sonuc;
sonuc=document.getElementsByClassName("task")[0];
sonuc=document.getElementsByClassName("task")[1];

ul=document.getElementById("task-list")
tasklist=ul.getElementsByTagName("li") //yine normal bütün li ulaşır
//tasklist=document.getElementsByClassName("task");
//liste içindeki element
// for(let i=0;i<tasklist.length;i++)
// {
//      console.log(tasklist[i]);
// }
//liste içindeki element
// for(let task of tasklist)
// {
//      console.log(task);
// }
//liste içindeki  index degeri
// for(let task in tasklist)
// {
//      console.log(task);
// }

tasklist=document.querySelectorAll("#task-list li")

for(let task of tasklist)
{
     task.style.color="red";
     task.style.fontsize="20px";
}

console.log(sonuc);

*/

//dom elemnetleri üzerinde gezinme
/*





// let sonuc;
// ul=document.getElementById("task-list");


// //children,firstElementChild,lastElementChild
// //parentElement
// //nextElementSibling,previousElementSibling
// sonuc=ul.children;
// sonuc=ul.children[0];
// sonuc=ul.firstElementChild;
// sonuc=ul.lastElementChild;
// sonuc=document.getElementById("title").parentElement;
// sonuc=document.querySelector(".task").nextElementSibling;




//ul=document.getElementById("task-list");
//sonuc=ul.children[0].children[0].children[0].checked=true;
//sonuc=ul.children[1].children[0].children[0].checked=true;


*/

/////dom elemeti oluşturma////
/*


let sonuc;
let gorevlistesi=["gorev1","Gorev2","gorev3"];


ul=document.getElementById("task-list");
//let count=ul.children.length;

for(let index in gorevlistesi)
{
  let li=`
    <li class="task list-group-item">
            <div class="form-check">
                    <input type="checkbox" id="${index+1}" class="form-check-input">    
                    <label for="${index+1}" class="form-check-label">Görev ${gorevlistesi}</label>         
                </div>                     
    </li>

    `; 
    
    
ul.insertAdjacentHTML("beforeend",li);

}

*/

//sonuc=document.querySelector("#task-list").removeAttribute("class");
//sonuc=document.querySelector("#task-list").children[1].removeAttribute("class");
//sonuc=document.querySelector("#task-list").children[1].getAttribute("class");
//sonuc=document.querySelector("#task-list").children[1].setAttribute("class","aaaa");
//sonuc=document.querySelector("#task-list").children[1].classList[0];
//sonuc=document.querySelector("#task-list").children[1].classList.add("bg-danger");

//sonuc=document.querySelector("#task-list").children[0].classList.add("bg-primary");
//sonuc=document.querySelector("#task-list").children[0].classList.remove("bg-primary");

//sonuc=document.querySelector("#task-list").children[0].classList.contains("bg-primary");// bu class'a sahipse  bool türünde değer döndürür.



////*/*//*//*/*///event-listeners/*/***/*/*/*/*/*/*/*/*/




let sonuc;
let gorevlistesi=[];

if(localStorage.getItem("gorevlistesi")!== null)
{
   gorevlistesi=JSON.parse(localStorage.getItem("gorevlistesi"));
}

let editId;
let isEditTask=false;

const taskinput=document.querySelector("#txtTaskName");
const temizle=document.querySelector("#btnCLEAR");
const filters=document.querySelectorAll(".filters span");




displayTask(document.querySelector("span.active").id);
function displayTask(filter)
{
 let ul=document.getElementById("task-list");
//let count=ul.children.length;
ul.innerHTML="";
          

        if(gorevlistesi.length==0)
        {
             ul.innerHTML ='<div class="alert alert-danger" role="alert"> Gorev Yok !!!</div>'
        }else{

       
                for(let  gorev of  gorevlistesi)
                {
                    let completed= gorev.durum ==  "completed"?"checked":"";
                    if(filter==gorev.durum || filter=="all"){
                     let li=`
                    <li class="task list-group-item">
                            <div class="form-check">
                                    <input type="checkbox" onclick="updateStatus(this)" id="${gorev.id}" class="form-check-input " ${completed}>    
                                    <label for="${gorev.id}" class="form-check-label ${completed}">${gorev.gorevadi}</label>         
                                </div>      
                                <div class="dropdown">
                                    <button class="btn btn-link dropdown-toggle" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fa-solid fa-ellipsis"></i>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                        <li><a onclick="deleteTask(${gorev.id})" class="dropdown-item" href="#"><i class="fa-solid fa-trash-can"></i> Sil</a></li>
                                        <li><a onclick='editTask(${gorev.id},"${gorev.gorevadi}")'class="dropdown-item" href="#"><i class="fa-solid fa-pen"></i> Düzenle</a></li>
                                    </ul>
                                </div>
                            </div>      
                    </li>
                    `;
                    ul.insertAdjacentHTML("beforeend",li);
                }
                    

               
                }   
            }


}



document.querySelector("#btnAddNewTask").addEventListener("click",Newtask);
document.querySelector("#btnAddNewTask").addEventListener("keypress",function(){
  if(event.key=="Enter")
  {
     document.getElementById("btnAddNewTask").click();
  }
});

document.querySelector("#btnCLEAR").addEventListener("click",function(event)
{
        console.log("click event:CLEAR");
        event.preventDefault();//ilgili elementin normal davranışını kapat
});

function Newtask(event)
{       
        let taskinput=document.querySelector("#txtTaskName");

        if(taskinput.value=="")
        {
             alert("gorev Girmelisiniz");
        }else{
              if(!isEditTask){
                gorevlistesi.push({"id":gorevlistesi.length+1,"gorevadi":taskinput.value ,"durum":"pending"})
              }else{
                 for(let gorev of gorevlistesi)
                 {
                     if(gorev.id==editId)
                     {
                         gorev.gorevadi=taskinput.value;

                     }
                     isEditTask=false;
                 }
              }

             
              taskinput.value="";
              displayTask(document.querySelector("span.active").id);
              localStorage.setItem("gorevlistesi",JSON.stringify(gorevlistesi));
        }
      
        event.preventDefault();//ilgili elementin normal davranışını kapat
};

function deleteTask(id)
{
      //console.log(id);
      let deletedid;
      for(let index in gorevlistesi)
      {
       
          if(gorevlistesi[index].id==id)
          {
            deletedid=index;
          }
      }

        // deletedid=gorevlistesi.findIndex(function(gorev){
        //       return gorev.id==id  ; 
        // });
       
        //arrow function
        //deletedid=gorevlistesi.findIndex(gorev=>gorev.id==id);

      gorevlistesi.splice(deletedid,1);
      displayTask(document.querySelector("span.active").id);
      localStorage.setItem("gorevlistesi",JSON.stringify(gorevlistesi));

}

function editTask(TaskId,taskName)
{
   editId=TaskId;
   isEditTask=true; 
   taskinput.value=taskName;
   taskinput.focus();
   taskinput.classList.add("Active");


}

temizle.addEventListener("click",function()
{
     gorevlistesi.splice(0,gorevlistesi.length);
     displayTask(document.querySelector("span.active").id);
     localStorage.setItem("gorevlistesi",JSON.stringify(gorevlistesi));
});

function updateStatus(selectedTask)
{
      //console.log(selectedTask.parentElement.lastElementChild);
      let label=selectedTask.nextElementSibling;
      let durum;
      if(selectedTask.checked)
      {
         label.classList.add("checked");
         durum="completed";
      }else{
            label.classList.remove("checked");
            durum="pending";
      }

       for(let gorev of gorevlistesi)
       {
          if(gorev.id==selectedTask.id)
          {
            gorev.durum=durum;
          }
       }

       displayTask(document.querySelector("span.active").id);

       localStorage.setItem("gorevlistesi",JSON.stringify(gorevlistesi));
}


for(let span of filters)
{
  span.addEventListener("click",function(){
        document.querySelector("span.active").classList.remove("active");
        span.classList.add("active");
        displayTask(span.id);
  });
}




</script>

</body>
</html>